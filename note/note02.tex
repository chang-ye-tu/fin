\documentclass[10pt]{beamer}

\usetheme{Madrid}
\usecolortheme{default}

% Base packages
%\usepackage{helvet}
\usepackage{amsmath,amssymb,amsthm,mathtools,subcaption}
\usepackage{tikz,pgfplots,tabularx,booktabs}
\usetikzlibrary{arrows.meta, positioning, quotes}

\usepackage{listings}
\usepackage{xcolor}

\usepackage[cache=false]{minted}
\renewcommand{\theFancyVerbLine}{\sffamily\textcolor[rgb]{0.5,0.5,1.0}{\scriptsize\oldstylenums{\arabic{FancyVerbLine}}}}
\definecolor{bg}{rgb}{.95,.95,.95}

% Font settings
\renewcommand{\familydefault}{\sfdefault}

% TikZ libraries
\usetikzlibrary{calc,positioning,backgrounds,decorations.pathreplacing}
\pgfplotsset{compat=1.14}

% Colors
\definecolor{deepblue}{RGB}{42,39,155}
\definecolor{lightpink}{RGB}{255,240,240}
\definecolor{lightgreen}{RGB}{240,255,240}
\definecolor{lightyellow}{RGB}{255,255,240}
\definecolor{codegray}{RGB}{245,245,245}
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codepurple}{rgb}{0.58,0,0.82}

% Beamer settings
\setbeamercolor{title}{fg=white,bg=deepblue}
\setbeamercolor{frametitle}{fg=white,bg=deepblue}
\setbeamercolor{section in head/foot}{fg=white,bg=deepblue}

% Code listing settings
\lstdefinelanguage{iPython}{
  language=Python,
  morekeywords={as,assert,async,await,break,class,continue,def,del,elif,else,
    except,finally,for,from,global,if,import,in,is,lambda,nonlocal,not,or,
    pass,raise,return,try,while,with,yield,True,False,None},
  sensitive=true,
  morecomment=[l]{\#},
  morestring=[b]',
  morestring=[b]"
}

\lstset{
    language=iPython,
    basicstyle=\ttfamily\small,
    backgroundcolor=\color{codegray},
    breaklines=true,
    showstringspaces=false,
    commentstyle=\color{codegreen},
    keywordstyle=\color{blue},
    stringstyle=\color{codepurple},
    numbers=none,
    frame=none
}

\setbeamertemplate{footline}[text line]{%
  \parbox{\linewidth}{\vspace*{-8pt}
  %\hfill\href{https://github.com/chang-ye-tu/fin}{https://github.com/chang-ye-tu/fin}
    \hfill
   \insertframenumber~/ \inserttotalframenumber}}
\setbeamertemplate{navigation symbols}{}%[only frame symbol]

\definecolor{foo}{rgb}{.2,.2,.7}
\AtBeginSection[]{
  \begin{frame}
  \vfill
  \centering
  \begin{beamercolorbox}[sep=8pt,center,shadow=true,rounded=true]{section page}
    \usebeamerfont{title}%
    {\color{foo} \insertsectionhead}\par%
  \end{beamercolorbox}
  \vfill
  \end{frame}
}

\DeclareMathOperator\prb{\mathsf{P}}
\DeclareMathOperator\expc{\mathsf{E}}
\DeclareMathOperator\var{var}
\DeclareMathOperator\cov{cov}
\DeclareMathOperator\cor{corr}
\DeclareMathOperator*{\argmax}{\arg\!\max}
\DeclareMathOperator*{\argmin}{\arg\!\min}
\DeclareMathOperator\corr{corr}
\DeclareMathOperator\rk{rank}
\DeclareMathOperator\sgn{sgn}
\DeclareMathOperator{\tr}{tr}

% Blackboard bold
\renewcommand{\AA}{\mathbb A}
\newcommand{\CC}{\mathbb C}
\newcommand{\DD}{\mathbb D}
\newcommand{\EE}{\mathbb E}
\newcommand{\FF}{\mathbb F}
\newcommand{\HH}{\mathbb H}
\newcommand{\KK}{\mathbb K}
\newcommand{\NN}{\mathbb N}
\newcommand{\PP}{\mathbb P}
\newcommand{\QQ}{\mathbb Q}
\newcommand{\RR}{\mathbb R}
\newcommand{\UU}{\mathbb U}
\newcommand{\ZZ}{\mathbb Z}

\newcommand{\ie}{\;\Longrightarrow\;}
\newcommand{\ifff}{\;\Longleftrightarrow\;}
\newcommand{\ds}{\displaystyle}

\title{Introduction to Financial Models \\ Lecture 02: Surprises \& Paradoxes II}
\author{}
\date{}

\begin{document}

\begin{frame}
\titlepage
\end{frame}

\subsection*{Outline}
\begin{frame}
  \tableofcontents
\end{frame}

\section{Coin Rotation Paradox}

\begin{frame}
\begin{center}
  \href{https://www.youtube.com/watch?v=FUHkTs-Ipfg}{\textbf{The 1982 SAT Question Everyone Got Wrong}}
  \vspace{1cm}

\begin{tikzpicture}[scale=.5]
    % Draw circle B (larger circle)
  \draw (0,0) circle (2.25cm);
    \node at (0,0) {B};
    
    % Draw circle A (smaller circle)
    \draw (0,3) circle (0.75cm);
    \node at (0,3) {A};
\end{tikzpicture}

\vspace{.5cm}

The radius of circle A is $\frac{1}{3}$ of the radius of circle B. Circle A rolls\\
around circle B one trip back to its starting point. How\\
many times will circle A revolve in total?

\vspace{.5cm}

\begin{tabular}{l@{\hspace{2em}}l@{\hspace{2em}}l@{\hspace{2em}}l@{\hspace{2em}}l}
  (a) $\frac{3}{2}$ & (b) 3 & (c) 6 & (d) $\frac{9}{2}$ & (e) 9
\end{tabular}
\end{center}

\vspace{.5cm}
\end{frame}

\begin{frame}{Animation of Coin Rotation Paradox}
  \input{coin.tex}
\end{frame}

\begin{frame}[allowframebreaks]
  \frametitle{Animation of Coin Rotation Paradox: Python Code}
  \inputminted[linenos=true,breaklines,breakanywhere,bgcolor=bg]{python}{fig/note02/coin_rotation_paradox.py}
\end{frame}

\section{Braess Paradox}

\begin{frame}{A Typical Case}
  \begin{figure}
    \includegraphics[scale=.8,page=1]{fig/note02/braess.pdf}
  \end{figure}
  \onslide<+->
  \begin{itemize}[<+->]
    \item A highway network, with each edge labeled by its travel time (in minutes) when there are $x$ cars using it
    \item Suppose there are 4000 cars need to get from A to B 
    \item They divide evenly over the two routes at equilibrium; the travel time is $45 + 2000 / 100 = 65$ mins
  \end{itemize}
\end{frame}

\begin{frame}{A Typical Case: Cont'd}
  \begin{figure}
    \includegraphics[scale=.8,page=2]{fig/note02/braess.pdf}
  \end{figure}
  \onslide<+->
  \begin{itemize}[<+->]
    \item Now a very fast edge is added from C to D to the previous highway network
    \item At equilibrium, every user uses the route through C and D 
    \item As a result, the travel time is $4000 / 10 + 0 + 4000 / 100 = 80$ mins!
  \end{itemize}
\end{frame}

\begin{frame}{Braess' Example}
  \begin{center}
    \begin{tikzpicture}[
        node distance=2cm and 3cm,
        main node/.style={circle, draw, fill=white, inner sep=2pt},
        every edge/.style={draw, -Stealth, thick},
        every label/.style={font=\small},
        scale=1.2
      ]
      % Nodes
      \node[main node] (P1) at (0,0) {$1$};
      \node[main node] (P2) at (3,2) {$2$};
      \node[main node] (P3) at (3,-2) {$3$};
      \node[main node] (P4) at (6,0) {$4$};

      % Edges with labels
      \draw (P1) edge node[above, sloped] {$50+b$} (P2);
      \draw (P2) edge node[above, sloped] {$10b$} (P4);
      \draw (P1) edge node[below, sloped] {$10b$} (P3);
      \draw (P3) edge node[below, sloped] {$50+b$} (P4);
      \draw (P3) edge node[right] {$10+b$} (P2);
    \end{tikzpicture}
  \end{center}
  \onslide<+->
  \begin{itemize}[<+->]
    \item Assume a flow of 6 units (e.g., 6000 vehicles) must travel from $1$ to $4$
    \item Three paths exist: $B_1 = 124$, $B_2 = 1324$, $B_3 = 134$
  \end{itemize}
\end{frame}

\begin{frame}{Braess' Example: Cont'd}
  \begin{itemize}[<+->]
    \item Case 1: All Paths Open. Split the flow equally (2 units each):
    \onslide<+->
    \begin{gather*}
      b_{12} = 2, \; b_{24} = 4, \; b_{34} = 2, \;b_{13} = 4, \; b_{32} = 2\\
      d_{12} = 52, \; d_{24} = 40, \; d_{34} = 52, \; d_{13} = 40, \; d_{32} = 12 \\
      L(B_1) = L(B_2) = L(B_3) = 92
    \end{gather*}
    \onslide<+->
    All paths are critical (maximal length). This distribution is stable: Switching paths increases load and travel time beyond 92.

    \item Case 2: Ban Edge $k_{32}$. Split flow equally between $B_1$ and $B_3$ (3 units each):
    \onslide<+->
    \begin{gather*}
      b_{12} = b_{24} = b_{13} = b_{34} = 3\\
      d_{12} = 53, \; d_{24} = 30, \; d_{13} = 30, \; d_{34} = 53\\
      L(B_1) = L(B_3) = 83
    \end{gather*}
    \onslide<+->
    Despite losing a connection, all paths are shorter!
\end{itemize}
\end{frame}

\begin{frame}{Braess' Example: Selfish Deviation}

  \begin{center}
    \begin{tikzpicture}[
        node distance=2cm and 3cm,
        main node/.style={circle, draw, fill=white, inner sep=2pt},
        every edge/.style={draw, -Stealth, thick},
        every label/.style={font=\small},
        scale=0.75
      ]
      % Nodes
      \node[main node] (P1) at (0,0) {$1$};
      \node[main node] (P2) at (3,2) {$2$};
      \node[main node] (P3) at (3,-2) {$3$};
      \node[main node] (P4) at (6,0) {$4$};

      % Edges with labels
      \draw (P1) edge node[above, sloped] {$50+b$} (P2);
      \draw (P2) edge node[above, sloped] {$10b$} (P4);
      \draw (P1) edge node[below, sloped] {$10b$} (P3);
      \draw (P3) edge node[below, sloped] {$50+b$} (P4);
      \draw (P3) edge node[right] {$10+b$} (P2);
    \end{tikzpicture}
  \end{center}
  \onslide<+->
  \begin{itemize}[<+->]
    \item $B_1 = 124$, $B_2 = 1324$, $B_3 = 134$
    \item A single vehicle ignoring the ban on $k_{32}$ (where $d_{32} = 10$) takes $B_2$ with $L(B_2) = 70$, gaining an advantage.
    \item If the ban is lifted, many use $B_2$, reverting to the original state. 
    \item Consider an intermediate step: 5 units on $B_1$ and $B_3$, 1 on $B_2$, then $L(B_1) = L(B_3) = 87.5$, $L(B_2) = 82.5$.
    \item $B_2$ users clog $k_{13}$ and $k_{24}$ (factor $10$ in load-time relation), worsening times for $B_1$ and $B_3$ beyond $83$; Yet $B_2$ remains shortest, attracting more traffic and degrading the system for all.
  \end{itemize}
\end{frame}

\begin{frame}{Real-Life Examples}
  \begin{itemize}[<+->]
    \item \href{https://www.youtube.com/watch?v=Cg73j3QYRJc}{The mechanical analogy: the spring paradox}
    \item \href{https://engines.egr.uh.edu/episode/2814}{Experimental road closure in NY (2009 ---)}
      \begin{center}
        \includegraphics[scale=.3]{fig/note02/nybefore.png}\hspace{3mm}
        \includegraphics[scale=.3]{fig/note02/nyafter.png}
      \end{center}
      %\begin{itemize}
      %  \item Two sections of Broadway where it obliquely crosses major north/south boulevards at Times and Herald Squares 
      %  \item The experiment was successful and the road closures were made permanent
      %  \item Times and Herald Squares are now home to pedestrian plazas
      %\end{itemize}
    \item \href{https://en.wikipedia.org/wiki/Cheonggyecheon}{Cheonggyecheon restoration project (2003 ---)}
      \begin{itemize}
        \item Replaced a six lane highway with a five mile long park, traffic flow improved
      \end{itemize}
  \end{itemize}
\end{frame}

\end{document}

\section{Voting Paradox}

\begin{frame}
  
  \begin{itemize}
    \item The Simplest Case
      \vspace{3mm}
      \begin{table}
        \center
        \begin{tabular}{cccc}
          \toprule
          \textbf{Voter} & \textbf{First preference} & \textbf{Second preference} & \textbf{Third preference} \\
          \midrule
          Voter 1 & A & B & C \\
          Voter 2 & B & C & A \\
          Voter 3 & C & A & B \\
          \bottomrule
        \end{tabular}
      \end{table}
      \vspace{3mm}
      \begin{center} A $>$ B $>$ C $>$ A \end{center}
      \vspace{1mm} 
    \item A More Complicated Situation
      \vspace{3mm}
      \begin{table}
        \center
        \begin{tabular}{llll}
          \toprule
          \textbf{Party} & \textbf{First preference} & \textbf{Second preference} & \textbf{Third preference} \\
          \midrule
          Left (3)   & education & health & security \\
          Center (4) & health & security & education \\
          Right (5)  & security & education & health \\
          \bottomrule
        \end{tabular}
      \end{table}
      \vspace{3mm}
        \begin{center} A $>$ B $>$ C $>$ A \end{center}
      \vspace{3mm} 
  \end{itemize}
\end{frame}

\section{Arrow's Impossibility Theorem}

\begin{frame}

\end{frame}

\section{St. Petersberg Paradox}

\begin{frame}{The Expected Utility Hypothesis}
\end{frame}

\begin{frame}{The Expected Utility Hypothesis}
  \begin{definition}
    The agent prefers the r.v. $X$ to r.v. $Y$ iff
    \begin{align*}
      \expc U(X) > \expc U(Y)
    \end{align*}
    where $\expc$ is the expectation operator, $U:\RR\mapsto\RR$ is the agent's utility function.
  \end{definition}
\end{frame}

\section{Allais Paradox}

\begin{frame}
  \begin{itemize}[<+->]\setlength\itemsep{0em}
    \item Game A
      \begin{align*}
        X = \begin{cases}101 & \text{prob. } 0.33\\100 & \text{prob. } 0.66\\ 0 & \text{prob. } 0.01 \end{cases} \qquad
        Y = 100 \;\text{ with prob. } 1
      \end{align*}
      \onslide<+->
      Mostly prefer $Y$ to $X$: from the Expected Utility Hypothesis 
      \onslide<+->
      \begin{multline}
        U(100) > 0.33\cdot U(101) + 0.66\cdot U(100) + 0.01\cdot U(0)\\ \ie 0.34\cdot U(100) > 0.33\cdot U(101) + 0.01\cdot U(0)
      \end{multline}
    \item Game B 
      \begin{align*}
        X = \begin{cases}100 & \text{prob. } 0.34\\ 0 & \text{prob. } 0.66 \end{cases} \qquad
        Y = \begin{cases}101 & \text{prob. } 0.33\\ 0 & \text{prob. } 0.67 \end{cases}
      \end{align*}
      \onslide<+->
      Mostly prefer $Y$ to $X$: from the Expected Utility Hypothesis 
      \onslide<+->
      \begin{multline}
        0.33\cdot U(101) + 0.67\cdot U(0) > 0.34\cdot U(100) + 0.66\cdot U(0)\\ \ie 0.33\cdot U(101) + 0.01\cdot U(0) > 0.34\cdot U(100)
      \end{multline}
  \end{itemize}
\end{frame}

\section{Ellsberg Paradox}

\begin{frame}
  \begin{itemize}[<+->]
    \item Given an urn with $30$ balls of colors red, yellow, and black
    \item There are $10$ red balls; total $20$ yellow / black balls, but the number of each type unknown
    \item The agent estimates the probability of drawing yellow as $p$ where $0 < p < \frac{2}{3}$
    \item A single ball is drawn from the urn
  \end{itemize}
\end{frame}

\begin{frame}
  \begin{itemize}[<+->]\setlength\itemsep{0em}
    \item Game A  
      \begin{align*}
        X = \begin{cases}100 & \text{if red}\\0 & \text{if yellow or black}\end{cases} \qquad
        Y = \begin{cases}100 & \text{if yellow}\\0 & \text{if red or black}\end{cases} \qquad
      \end{align*}
      \onslide<+->
      Mostly prefer $X$ to $Y$: from the Expected Utility Hypothesis 
      \onslide<+->
      \begin{multline}
        \frac{1}{3}\cdot U(100) + \frac{2}{3}\cdot U(0) > p\cdot U(100) + (1 - p)\cdot U(0) \\ \ie\big(\frac{1}{3} - p\big)\cdot U(100) > \big(\frac{1}{3} - p\big)\cdot U(0)
      \end{multline}
    \item Game B 
      \begin{align*}
        X = \begin{cases}100 & \text{if red or black}\\ 0 & \text{if yellow}\end{cases} \qquad
        Y = \begin{cases}100 & \text{if yellow or black}\\ 0 & \text{if red}\end{cases}
      \end{align*}
      \onslide<+->
      Mostly prefer $Y$ to $X$: from the Expected Utility Hypothesis 
      \onslide<+->
      \begin{multline}
        \frac{2}{3}\cdot U(100) + \frac{1}{3}\cdot U(0) > (1 - p)\cdot U(100) + p\cdot U(0) \\ \ie\big(\frac{1}{3} - p\big)\cdot U(0) > \big(\frac{1}{3} - p\big)\cdot U(100)
      \end{multline}
  \end{itemize}
\end{frame}

\end{document}
